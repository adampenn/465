<p id="notice"><%= notice %></p>

<h1>Listing Images</h1>
<hr>
<% pub = false %>
<% pri = false %>
<% sha = false %>
<% if !user_signed_in? %>
  <table>
  <% @images.each do |image| %>
    <% if image.private != true %>
    <% if !pub %>
      <h2>Public Images</h2>
      <% pub = true %>
    <% end %>
    <%= link_to image do %>
      <%= image_tag root_url + "/images/" + image.filename, size: "100x100", alt: image.filename %>  
    <% end %>
      <% @users.each do |user| %>
        <% if user.id == image.user_id %>
          <%= user.name %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<% if user_signed_in? %>
  <% @images.each do |image| %>
    <% if image.private != true and image.user_id != current_user.id %>
      <% if !pub %>
        <h2>Public Images</h2>
        <% pub = true %>
      <% end %>
      <%= link_to image do %>
        <%= image_tag root_url + "/images/" + image.filename, size: "100x100", alt: image.filename %>  
      <% end %>
      <% @users.each do |user| %>
        <% if user.id == image.user_id %>
          <%= user.name %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <hr>
  <% @images.each do |image| %>
    <%if image.user_id ==  current_user.id %>
      <% if !pri %>
        <h2>Images you own</h2>
        <% pri = true %>
      <% end %>
      <%= link_to image do %>
        <%= image_tag root_url + "/images/" + image.filename, size: "100x100", alt: image.filename %>
      <% end %>
      <%= link_to 'Edit', edit_image_path(image) %>
      <%= link_to 'Destroy', image, method: :delete, data: { confirm: 'Are you sure?' } %>
    <% end %>
  <% end %>
  <hr>
  <% @imageusers.each do |imageuser| %>
    <%if imageuser.user_id == current_user.id %>
      <% @images.each do |image| %>
        <% if !sha %>
          <h2>Images shared with you</h2>
          <% sha = true %>
        <% end %>
        <% if image.private == true and imageuser.image_id == image.id %>
          <%= link_to image do %>
            <%= image_tag root_url + "/images/" + image.filename, size: "100x100", alt: image.filename %>
          <% end %>
          <% @users.each do |user| %>
            <% if user.id == image.user_id %>
              <%= user.name %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <br><br>

  <hr>

  <%= link_to 'New Image', new_image_path %>

<% end %>
